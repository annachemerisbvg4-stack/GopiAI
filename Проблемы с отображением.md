# üîß **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∞—Ç–∞ –≤ GopiAI**

–û—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –≥–ª—É–±–æ–∫–æ–º –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏, –ø—Ä–µ–¥–ª–∞–≥–∞—é —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

## üìä **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º –∏ –∏—Ö –∫–æ—Ä–Ω–µ–≤—ã–µ –ø—Ä–∏—á–∏–Ω—ã**

### **1. –ü—Ä–æ–±–ª–µ–º–∞ –æ–±—Ä—ã–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**
**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Qt –≤–∏–¥–∂–µ—Ç–æ–≤ –∏ –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ UI –ø–æ—Ç–æ–∫–µ
- QTextEdit –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∏ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### **2. –ü—Ä–æ–±–ª–µ–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è JSON —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤**  
**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
- –°–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è API –Ω–µ –æ—Ç–¥–µ–ª—è–µ—Ç—Å—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- –ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–ª–æ—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤

### **3. –ü—Ä–æ–±–ª–µ–º–∞ HTML –≤ —Ñ–∞–π–ª–∞—Ö**
**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ HTML –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- HTML —Ä–∞–∑–º–µ—Ç–∫–∞ –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª—ã
- –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞

## üõ†Ô∏è **–î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è**

### **–†–µ—à–µ–Ω–∏–µ 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Qt UI**

#### **A. –ó–∞–º–µ–Ω–∞ QTextEdit –Ω–∞ QPlainTextEdit –¥–ª—è —á–∞—Ç–∞**

```python
# chat_widget.py - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–∞—Ç –≤–∏–¥–∂–µ—Ç
from PySide6.QtWidgets import QPlainTextEdit, QTextCursor
from PySide6.QtCore import QTimer, Qt
from PySide6.QtGui import QTextCharFormat, QFont

class OptimizedChatWidget(QPlainTextEdit):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_buffer()
        
    def setup_ui(self):
        # QPlainTextEdit –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
        self.setReadOnly(True)
        self.setMaximumBlockCount(1000)  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞
        self.setFont(QFont("Consolas", 10))
        
    def setup_buffer(self):
        self.text_buffer = []
        self.buffer_timer = QTimer()
        self.buffer_timer.timeout.connect(self.flush_buffer)
        self.buffer_timer.setSingleShot(True)
        
    def append_text_optimized(self, text):
        """–ë—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞"""
        self.text_buffer.append(text)
        
        # –°–±—Ä–æ—Å –±—É—Ñ–µ—Ä–∞ —á–µ—Ä–µ–∑ 100–º—Å –∏–ª–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
        if len(self.text_buffer) >= 10:
            self.flush_buffer()
        else:
            self.buffer_timer.start(100)
            
    def flush_buffer(self):
        """–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–±—Ä–æ—Å –±—É—Ñ–µ—Ä–∞ –≤ UI"""
        if not self.text_buffer:
            return
            
        # –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –≤ –∫–æ–Ω–µ—Ü
        cursor = self.textCursor()
        cursor.movePosition(QTextCursor.End)
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ –±—É—Ñ–µ—Ä–∞ –∑–∞ –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é
        text_to_add = ''.join(self.text_buffer)
        cursor.insertText(text_to_add)
        
        # –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
        self.ensureCursorVisible()
        
        self.text_buffer.clear()
        self.buffer_timer.stop()
```

#### **B. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UI**

```python
# async_chat_handler.py - —É–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
from PySide6.QtCore import QThread, pyqtSignal, QTimer
import time

class AsyncChatHandler(QThread):
    message_chunk_received = pyqtSignal(str)
    message_completed = pyqtSignal(dict)
    
    def __init__(self, api_client):
        super().__init__()
        self.api_client = api_client
        self.current_task_id = None
        self.polling_active = False
        
    def send_message(self, message):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞—á–∞–ª–æ polling"""
        response = self.api_client.send_message(message)
        self.current_task_id = response.get('task_id')
        
        if self.current_task_id:
            self.polling_active = True
            self.start()
            
    def run(self):
        """–£–ª—É—á—à–µ–Ω–Ω—ã–π polling —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π"""
        delay = 0.5  # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
        max_delay = 5.0
        
        while self.polling_active and self.current_task_id:
            try:
                status = self.api_client.get_task_status(self.current_task_id)
                
                if status.get('status') == 'completed':
                    self.handle_completion(status)
                    break
                elif status.get('status') == 'in_progress':
                    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    self.handle_partial_result(status)
                    
                # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
                time.sleep(delay)
                delay = min(delay * 1.2, max_delay)
                
            except Exception as e:
                print(f"Polling error: {e}")
                time.sleep(1)
                
    def handle_partial_result(self, status):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è streaming"""
        if 'partial_response' in status:
            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            clean_text = self.filter_response(status['partial_response'])
            if clean_text:
                self.message_chunk_received.emit(clean_text)
                
    def handle_completion(self, status):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞"""
        self.polling_active = False
        filtered_response = self.filter_response(status)
        self.message_completed.emit(filtered_response)
        
    def filter_response(self, response_data):
        """–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
        if isinstance(response_data, dict):
            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
            user_content = response_data.get('response', '')
            
            # –£–¥–∞–ª—è–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ JSON –±–ª–æ–∫–∏
            import re
            # –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è JSON –±–ª–æ–∫–æ–≤
            json_pattern = r'\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}'
            clean_content = re.sub(json_pattern, '', user_content)
            
            return clean_content.strip()
        return str(response_data)
```

### **–†–µ—à–µ–Ω–∏–µ 2: –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–æ–≤ –≤ Flask Backend**

#### **A. –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

```python
# response_formatter.py - –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
import re
import json
from typing import Dict, Any

class ResponseFormatter:
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ü–µ–ª–µ–π"""
    
    def __init__(self):
        self.json_pattern = re.compile(r'\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}')
        self.html_pattern = re.compile(r'<[^<>]*>')
        
    def format_for_chat(self, raw_response: Dict[str, Any]) -> Dict[str, Any]:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —á–∞—Ç–µ"""
        formatted = {
            'user_content': self.extract_user_content(raw_response),
            'metadata': self.extract_metadata(raw_response),
            'status': raw_response.get('status', 'completed')
        }
        return formatted
        
    def format_for_file_export(self, raw_response: Dict[str, Any]) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ —Ñ–∞–π–ª"""
        content = self.extract_user_content(raw_response)
        # –£–¥–∞–ª–µ–Ω–∏–µ HTML —Ç–µ–≥–æ–≤ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
        clean_content = self.remove_html_tags(content)
        return clean_content
        
    def extract_user_content(self, response_data: Dict[str, Any]) -> str:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞"""
        content = response_data.get('response', '')
        
        # –£–¥–∞–ª–µ–Ω–∏–µ JSON –±–ª–æ–∫–æ–≤ —Å —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        clean_content = self.json_pattern.sub('', content)
        
        # –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤
        clean_content = re.sub(r'\n\s*\n', '\n\n', clean_content.strip())
        
        return clean_content
        
    def extract_metadata(self, response_data: Dict[str, Any]) -> Dict[str, Any]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"""
        return {
            'processed_with_crewai': response_data.get('processed_with_crewai', False),
            'analysis': response_data.get('analysis', {}),
            'execution_time': response_data.get('execution_time'),
            'commands_executed': len(response_data.get('analysis', {}).get('command_results', []))
        }
        
    def remove_html_tags(self, text: str) -> str:
        """–£–¥–∞–ª–µ–Ω–∏–µ HTML —Ç–µ–≥–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞"""
        # –ó–∞–º–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö HTML —Ç–µ–≥–æ–≤ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã
        text = re.sub(r'<br\s*/?>', '\n', text)
        text = re.sub(r'<p>', '\n', text)
        text = re.sub(r'</p>', '\n', text)
        text = re.sub(r'<strong>(.*?)</strong>', r'**\1**', text)
        text = re.sub(r'<em>(.*?)</em>', r'*\1*', text)
        
        # –£–¥–∞–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö HTML —Ç–µ–≥–æ–≤
        text = self.html_pattern.sub('', text)
        
        # –û—á–∏—Å—Ç–∫–∞ –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤
        text = re.sub(r'\n\s*\n\s*\n', '\n\n', text)
        
        return text.strip()
```

#### **B. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API endpoint —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º**

```python
# crewai_api_server.py - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
from response_formatter import ResponseFormatter

app = Flask(__name__)
formatter = ResponseFormatter()

@app.route('/api/chat/send', methods=['POST'])
def send_message():
    """–£–ª—É—á—à–µ–Ω–Ω—ã–π endpoint —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–æ–≤"""
    try:
        data = request.json
        message = data.get('message', '')
        format_type = data.get('format', 'chat')  # chat, file, raw
        
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ SmartDelegator
        raw_response = smart_delegator.process_message(message)
        
        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
        if format_type == 'chat':
            formatted_response = formatter.format_for_chat(raw_response)
        elif format_type == 'file':
            formatted_response = {
                'content': formatter.format_for_file_export(raw_response),
                'metadata': formatter.extract_metadata(raw_response)
            }
        else:
            formatted_response = raw_response
            
        return jsonify({
            'status': 'success',
            'data': formatted_response,
            'task_id': f"task_{int(time.time())}"
        })
        
    except Exception as e:
        return jsonify({
            'status': 'error',
            'error': str(e)
        }), 500

@app.route('/api/chat/status/<task_id>', methods=['GET'])
def get_task_status(task_id):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏ —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
    # –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã Redis/RQ
    return jsonify({
        'status': 'completed',
        'data': formatter.format_for_chat(cached_response)
    })
```

### **–†–µ—à–µ–Ω–∏–µ 3: HTML —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bleach**

#### **A. –ú–æ–¥—É–ª—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ HTML**

```python
# html_sanitizer.py
import bleach
from bleach.html5lib_shim import HTMLParser
import re

class HTMLSanitizer:
    """–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ü–µ–ª–µ–π"""
    
    def __init__(self):
        # –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI
        self.allowed_ui_tags = [
            'p', 'br', 'strong', 'em', 'u', 'i', 'b',
            'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',
            'blockquote', 'code', 'pre'
        ]
        
        # –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
        self.allowed_attributes = {
            '*': ['class'],
            'a': ['href', 'title'],
        }
        
    def sanitize_for_ui(self, html_content: str) -> str:
        """–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI"""
        return bleach.clean(
            html_content,
            tags=self.allowed_ui_tags,
            attributes=self.allowed_attributes,
            strip=True
        )
        
    def sanitize_for_file(self, html_content: str) -> str:
        """–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ HTML –¥–ª—è —Ñ–∞–π–ª–æ–≤"""
        # –°–Ω–∞—á–∞–ª–∞ –∑–∞–º–µ–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–≥–∏ –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã
        text = self.convert_html_to_text(html_content)
        
        # –ó–∞—Ç–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º –æ—Ç HTML
        clean_text = bleach.clean(text, tags=[], strip=True)
        
        return clean_text
        
    def convert_html_to_text(self, html_content: str) -> str:
        """–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç"""
        # –ó–∞–º–µ–Ω—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ–≥–æ–≤
        conversions = {
            r'<br\s*/?>' : '\n',
            r'<p>' : '\n',
            r'</p>' : '\n',
            r'<h([1-6])>' : r'\n\n',
            r'</h[1-6]>' : r'\n\n',
            r'<strong>(.*?)</strong>' : r'**\1**',
            r'<em>(.*?)</em>' : r'*\1*',
            r'<code>(.*?)</code>' : r'`\1`',
            r'<ul>' : '\n',
            r'</ul>' : '\n',
            r'<ol>' : '\n',
            r'</ol>' : '\n',
            r'<li>' : '‚Ä¢ ',
            r'</li>' : '\n',
            r'<blockquote>' : '\n> ',
            r'</blockquote>' : '\n',
        }
        
        text = html_content
        for pattern, replacement in conversions.items():
            text = re.sub(pattern, replacement, text, flags=re.IGNORECASE)
            
        return text
        
    def extract_plain_text(self, html_content: str) -> str:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —á–∏—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
        return bleach.clean(html_content, tags=[], strip=True)
```

#### **B. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ç–æ—Ä–∞ –≤ —Å–∏—Å—Ç–µ–º—É**

```python
# –í smart_delegator.py
from html_sanitizer import HTMLSanitizer

class SmartDelegator:
    def __init__(self):
        self.html_sanitizer = HTMLSanitizer()
        # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        
    def process_message(self, message: str) -> dict:
        # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞
        
        # –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º
        if 'response' in result:
            # –î–ª—è UI - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π HTML
            result['response_ui'] = self.html_sanitizer.sanitize_for_ui(result['response'])
            # –î–ª—è —Ñ–∞–π–ª–æ–≤ - —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç
            result['response_file'] = self.html_sanitizer.sanitize_for_file(result['response'])
            
        return result
```

### **–†–µ—à–µ–Ω–∏–µ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**

#### **A. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –≥–ª–∞–≤–Ω—ã–π UI –∫–ª–∞—Å—Å**

```python
# main_chat_window.py
from PySide6.QtWidgets import QMainWindow, QVBoxLayout, QWidget
from optimized_chat_widget import OptimizedChatWidget
from async_chat_handler import AsyncChatHandler
from crewai_client import CrewAIClient

class MainChatWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setup_ui()
        self.setup_handlers()
        
    def setup_ui(self):
        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —á–∞—Ç –≤–∏–¥–∂–µ—Ç–∞
        self.chat_widget = OptimizedChatWidget()
        
        # –û—Å—Ç–∞–ª—å–Ω–∞—è UI
        central_widget = QWidget()
        layout = QVBoxLayout(central_widget)
        layout.addWidget(self.chat_widget)
        
        self.setCentralWidget(central_widget)
        
    def setup_handlers(self):
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
        self.api_client = CrewAIClient()
        self.chat_handler = AsyncChatHandler(self.api_client)
        
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
        self.chat_handler.message_chunk_received.connect(
            self.chat_widget.append_text_optimized
        )
        self.chat_handler.message_completed.connect(
            self.on_message_completed
        )
        
    def send_message(self, message: str):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ —É–ª—É—á—à–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫"""
        self.chat_handler.send_message(message)
        
    def on_message_completed(self, response_data: dict):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞"""
        # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        user_content = response_data.get('user_content', '')
        if user_content:
            self.chat_widget.append_text_optimized(f"\n\n--- –û—Ç–≤–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω ---\n")
            
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        metadata = response_data.get('metadata', {})
        if metadata.get('commands_executed', 0) > 0:
            status_text = f"\n–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∫–æ–º–∞–Ω–¥: {metadata['commands_executed']}"
            self.chat_widget.append_text_optimized(status_text)
```

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è**

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- **QPlainTextEdit** - –¥–æ 10x –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤
- **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è** - —Å–Ω–∏–∂–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ UI –Ω–∞ 90%
- **–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π polling** - —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- **HTML —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è** - –∑–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è JSON** - —Å–æ–∫—Ä—ã—Ç–∏–µ —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**
- **–ü–ª–∞–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** - –±–µ–∑ –æ–±—Ä—ã–≤–æ–≤ –∏ –∑–∞–≤–∏—Å–∞–Ω–∏–π
- **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω–∏—è
- **–ß–∏—Å—Ç—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å**
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## üìà **–ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è**

### **–§–∞–∑–∞ 1: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è UI (1-2 –¥–Ω—è)**
1. –ó–∞–º–µ–Ω–∞ QTextEdit –Ω–∞ OptimizedChatWidget
2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **–§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ Backend (2-3 –¥–Ω—è)**
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ResponseFormatter
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API endpoints
3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è HTML —Å–∞–Ω–∏—Ç–∏–∑–∞—Ç–æ—Ä–∞

### **–§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)**
1. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
2. –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### **–§–∞–∑–∞ 4: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (1 –¥–µ–Ω—å)**
1. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

## üîß **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ**

### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
CHAT_WIDGET_SETTINGS = {
    'max_buffer_size': 10,  # –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
    'buffer_timeout': 100,   # –¢–∞–π–º–∞—É—Ç —Å–±—Ä–æ—Å–∞ –±—É—Ñ–µ—Ä–∞ (–º—Å)
    'max_blocks': 1000,     # –ú–∞–∫—Å–∏–º—É–º –±–ª–æ–∫–æ–≤ –≤ QPlainTextEdit
    'polling_initial_delay': 0.5,  # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ polling
    'polling_max_delay': 5.0,      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
}

HTML_SANITIZER_SETTINGS = {
    'allowed_tags': ['p', 'br', 'strong', 'em', 'code', 'pre'],
    'strip_comments': True,
    'convert_charrefs': True
}
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```python
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

# –õ–æ–≥–≥–µ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
chat_logger = logging.getLogger('gopiAI.chat')
api_logger = logging.getLogger('gopiAI.api')
formatter_logger = logging.getLogger('gopiAI.formatter')
```

–î–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∞—Ç–∞, —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∞ —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è GopiAI.



# üîß **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é:**


---

### **–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è**
#### **1. –û–±—Ä—ã–≤ —Å–æ–æ–±—â–µ–Ω–∏–π (–ü—Ä–æ–±–ª–µ–º–∞ #1)**
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è:**
  - –ü–µ—Ä–µ—Ö–æ–¥ —Å `QTextEdit` –Ω–∞ `QPlainTextEdit` –æ–±–æ—Å–Ω–æ–≤–∞–Ω, —Ç–∞–∫ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ª—É—á—à–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏ —Ç–µ–∫—Å—Ç–∞.
  - –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º –∏ –ø–æ—Ä–æ–≥–æ–º (10 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤) —Å–Ω–∏–∂–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π UI, —á—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
  - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ polling-–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî —Ä–∞–∑—É–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
  
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
  - **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å UI:** –í –∫–æ–¥–µ `AsyncChatHandler` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `QThread`, –Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª—ã –∏ —Å–ª–æ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `message_chunk_received`), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞–±–æ—Ç—ã —Å –≤–∏–¥–∂–µ—Ç–∞–º–∏ –≤–Ω–µ –ø–æ—Ç–æ–∫–∞ GUI.
  - **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** –í –º–µ—Ç–æ–¥–µ `handle_partial_result` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `response_data.get('partial_response')`, –Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ backend —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ù—É–∂–Ω–∞ —á–µ—Ç–∫–∞—è –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É frontend –∏ backend –æ —Ñ–æ—Ä–º–∞—Ç–µ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `event stream`).
  - **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏:** –¢–µ–∫—É—â–∏–π –ø–æ—Ä–æ–≥ –≤ 10 —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.

#### **2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ JSON-—Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ (–ü—Ä–æ–±–ª–µ–º–∞ #2)**
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è:**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è JSON-–±–ª–æ–∫–æ–≤ –≤ `filter_response` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ—Å—Ç—ã–ª—å, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞—è—Ö.
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `ResponseFormatter` –Ω–∞ –±—ç–∫–µ–Ω–¥–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
  
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
  - **–ù–µ–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π:** –†–µ–≥—É–ª—è—Ä–∫–∏ –º–æ–≥—É—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ JSON-–æ–±—ä–µ–∫—Ç—ã. –õ—É—á—à–µ –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä—å –∏ –≤—ã–¥–µ–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª–µ `response`.
  - **–°–ª—É–∂–µ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ —á–∞—Ç–µ:** –í –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–µ —É–ø–æ–º—è–Ω—É—Ç–∞ –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–∞–Ω–¥). –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ UI.
  - **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ backend:** –í `format_for_chat` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `user_content` –∏ `metadata`, –Ω–æ frontend –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ –æ–∂–∏–¥–∞—Ç—å —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç. –ù—É–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

#### **3. HTML-—Ç–µ–≥–∏ –≤ —Ñ–∞–π–ª–∞—Ö (–ü—Ä–æ–±–ª–µ–º–∞ #3)**
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏—è:**
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `bleach` –¥–ª—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ ‚Äî –Ω–∞–¥–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —Ç–∞–∫ –∫–∞–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–µ–º.
  - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ `sanitize_for_ui` –∏ `sanitize_for_file` ‚Äî –≤–µ—Ä–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**
  - **–ù–µ–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–≥–æ–≤:** –í `convert_html_to_text` –Ω–µ –≤—Å–µ HTML-—Ç–µ–≥–∏ –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `<table>`, `<div>`). –ù—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ–Ω –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `html2text`).
  - **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ CSS:** –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π CSS, –æ–Ω –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤ —Ç–µ–∫—Å—Ç–µ. `bleach` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–¥–∞–ª—è–µ—Ç —Å—Ç–∏–ª–∏, –Ω–æ —Å—Ç–æ–∏—Ç —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å —ç—Ç–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.
  - **Markdown-–ø–æ–¥–¥–µ—Ä–∂–∫–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å markdown, –µ–≥–æ –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –≤ —Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `markdown2`).

---

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é**
#### **1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
- **WebSocket –≤–º–µ—Å—Ç–æ polling:** –î–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∞—Ç–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å WebSocket (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Socket.IO` –∏–ª–∏ `Starlette WebSocket`). –≠—Ç–æ —É–º–µ–Ω—å—à–∏—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
- **–°–ª–æ–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞:** –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `ContentFormatter`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç:
  - –†–∞–∑–¥–µ–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (—Ç–µ–∫—Å—Ç, HTML, markdown).
  - –û—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—é —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É (—á–∞—Ç/—Ñ–∞–π–ª).
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:** –•—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ Redis –∏–ª–∏ –¥—Ä—É–≥–æ–º –∫—ç—à–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

#### **2. –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–¥–∞**
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫ –∏ —Å—Ç–∏–ª—è:**
  - –í –∫–æ–¥–µ —Ä–µ—à–µ–Ω–∏—è –µ—Å—Ç—å –æ—à–∏–±–∫–∏: `QTextCharFo rmat`, `pyqtSi gnal`, `de f`, `ex ecution_time` –∏ –¥—Ä—É–≥–∏–µ. –ù—É–∂–Ω–∞ —Ç—â–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.
  - –°–ª–µ–¥–æ–≤–∞—Ç—å PEP8 –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `camelCase` vs `snake_case`).
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è `ResponseFormatter`, `HTMLSanitizer` –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞.
  - –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100KB —Ç–µ–∫—Å—Ç–∞).
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–π—Å—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã, –ø–∞—Ä—Å–∏–Ω–≥, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ).

#### **3. UX-—É–ª—É—á—à–µ–Ω–∏—è**
- **–ü—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥).
- **–û–ø—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞ –æ–ø—Ü–∏–∏:
  - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å/—Å–∫—Ä—ã–≤–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–∫–æ–ª-–≤–æ –∫–æ–º–∞–Ω–¥, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).
  - –§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ (—Ç–µ–∫—Å—Ç, markdown, HTML).
- **–í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥:** –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –±–ª–æ–∫–µ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–µ–ª–µ–Ω—ã–π –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö, –∫—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—à–∏–±–æ–∫).

#### **4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:** –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ backend –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ `pydantic` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏.
- **XSS-—É—è–∑–≤–∏–º–æ—Å—Ç–∏:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `bleach` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º HTML-–≤—ã–≤–æ–¥–∞–º (–¥–∞–∂–µ –≤ —á–∞—Ç–µ).
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç—ã –Ω–∞ –¥–ª–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –≥–ª—É–±–∏–Ω—É –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

---

### **–ü—Ä–∏–º–µ—Ä —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞**
#### **WebSocket-–æ–±–º–µ–Ω (backend):**
```python
# –í crewai_api_server.py
from flask_socketio import SocketIO, emit

socketio = SocketIO(app, cors_allowed_origins="*")

@socketio.on('chat_message')
def handle_chat_message(data):
    message = data['message']
    task_id = f"task_{int(time.time())}"
    # –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ñ–æ–Ω–µ
    # –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
    emit('partial_response', {'task_id': task_id, 'content': chunk})
    # –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
    emit('final_response', {'task_id': task_id, 'content': final_response})
```

#### **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (frontend —Å WebSocket):**
```python
# –í async_chat_handler.py
class WebSocketChatHandler(QObject):
    def __init__(self, socket):
        super().__init__()
        self.socket = socket
        self.socket.on('partial_response', self.handle_partial_response)
        
    def send_message(self, message):
        self.socket.emit('chat_message', {'message': message})
        
    def handle_partial_response(self, data):
        chunk = data['content']
        self.message_chunk_received.emit(chunk)
```

---

### **–ò—Ç–æ–≥**
–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ä–µ—à–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–ª–∞—Å—Ç—è—Ö:
1. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∏–ª—è.
2. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ WebSocket –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫.
3. –£—Å–∏–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ —á–µ—Ç–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

–≠—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∞—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≥–∏–±–∫–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã, —á—Ç–æ –ø–æ–≤—ã—Å–∏—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.