#!/bin/bash

echo "======================================================"
echo "   Запуск CrewAI API сервера для интеграции с UI"
echo "======================================================"
echo ""

# Проверяем наличие окружения
if [ ! -d "crewai_env" ]; then
    echo "[1/4] Создание виртуального окружения CrewAI..."
    python3 -m venv crewai_env
    if [ $? -ne 0 ]; then
        echo "[ОШИБКА] Не удалось создать виртуальное окружение!"
        echo "Убедитесь, что Python установлен и доступен в PATH."
        exit 1
    fi
fi

# Активируем окружение CrewAI
echo "[2/4] Активация окружения CrewAI..."
source crewai_env/bin/activate
if [ $? -ne 0 ]; then
    echo "[ОШИБКА] Не удалось активировать окружение CrewAI!"
    exit 1
fi

# Устанавливаем зависимости
echo "[3/4] Проверка и установка зависимостей..."
pip install -r requirements.txt
if [ $? -ne 0 ]; then
    echo "[ПРЕДУПРЕЖДЕНИЕ] Возникли проблемы при установке некоторых зависимостей."
    echo "Сервер может работать с ограниченной функциональностью."
    read -p "Нажмите Enter, чтобы продолжить..."
fi

# Запускаем сервер через debug wrapper
echo "[4/4] Запуск CrewAI API сервера..."
echo ""
echo "CrewAI API будет доступен по адресу http://127.0.0.1:5050"
echo "Для остановки сервера нажмите Ctrl+C"
echo "======================================================"
echo ""

python debug_wrapper.py

# В случае ошибки
if [ $? -ne 0 ]; then
    echo ""
    echo "[ОШИБКА] Не удалось запустить CrewAI API сервер!"
    echo "Проверьте консоль на наличие ошибок."
fi