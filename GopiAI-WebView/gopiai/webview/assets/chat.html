<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GopiAI WebView Chat</title>
    <link rel="stylesheet" href="chat.css">
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS –∏ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        console.log('Loading puter.js...');
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT') {
                console.error('Failed to load script:', e.target.src);
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-details').textContent = 'Failed to load: ' + e.target.src;
            }
        });
    </script>
    <script src="https://js.puter.com/v2/" onerror="console.error('puter.js failed to load')"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
</head>
<body>
    <div class="chat-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ -->
        <div class="chat-header">
            <div class="header-left">
                <h1>GopiAI Chat</h1>
                <div class="model-selector">
                    <label for="model-select">Model:</label>
                    <select id="model-select">
                        <option value="claude-sonnet-4" selected>Claude Sonnet 4</option>
                        <option value="claude-opus-4">Claude Opus 4</option>
                    </select>
                </div>
            </div>
            <div class="header-right">
                <button id="test-automation-btn" class="header-btn" title="Test Browser Automation">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                        <line x1="8" y1="21" x2="16" y2="21"></line>
                        <line x1="12" y1="17" x2="12" y2="21"></line>
                    </svg>
                </button>
                <button id="export-btn" class="header-btn" title="Export Chat">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7,10 12,15 17,10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <button id="history-btn" class="header-btn" title="Chat History & Memory">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12,6 12,12 16,14"></polyline>
                    </svg>
                </button>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
        <div id="error-message" style="display: none; background: #ff4444; color: white; padding: 10px; margin: 10px; border-radius: 5px;">
            <strong>‚ö†Ô∏è Network Error:</strong> <span id="error-details"></span>
            <br><small>Check your internet connection and firewall settings.</small>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div class="chat-messages" id="chat-messages">
            <div class="welcome-message">
                <div class="ai-message">
                    <div class="message-header">
                        <span class="sender">ü§ñ GopiAI Assistant</span>
                        <span class="model-badge">Claude Sonnet 4</span>
                    </div>
                    <div class="message-content">
                        Welcome to GopiAI WebView Chat! I'm powered by puter.js and ready to help you. 
                        You can switch between Claude Sonnet 4 and Claude Opus 4 models using the dropdown above.
                    </div>
                </div>
            </div>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ -->
        <div class="typing-indicator" id="typing-indicator" style="display: none;">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <span class="typing-text">AI is thinking...</span>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ -->
        <div class="chat-input-area">
            <div class="input-container">
                <textarea 
                    id="message-input" 
                    placeholder="Type your message here... (Shift+Enter for new line, Enter to send)"
                    rows="1"
                ></textarea>
                <button id="send-btn" class="send-button" title="Send Message">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤ -->
    <div class="modal" id="history-modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="modal-icon">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12,6 12,12 16,14"></polyline>
                    </svg>
                    Chat History
                </h2>
                <button class="close-btn" id="close-history">&times;</button>
            </div>
            <div class="modal-body">
                <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="history-controls">
                    <div class="control-group">
                        <button id="new-chat-btn" class="primary-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            New Chat
                        </button>
                        <button id="export-history-btn" class="secondary-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export Current
                        </button>
                        <div class="export-format-group">
                            <select id="export-format-select">
                                <option value="txt">Text (.txt)</option>
                                <option value="md">Markdown (.md)</option>
                                <option value="json">JSON (.json)</option>
                            </select>
                        </div>
                    </div>
                    <div class="search-group">
                        <input type="text" id="history-search" placeholder="Search chat history..." class="search-input">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="search-icon">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="M21 21L16.65 16.65"></path>
                        </svg>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
                <div class="history-list" id="history-list">
                    <div class="loading-placeholder" id="history-loading">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spinner">
                            <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
                        </svg>
                        Loading chat history...
                    </div>
                    
                    <!-- –ü—Ä–∏–º–µ—Ä—ã —á–∞—Ç–æ–≤ (–±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏) -->
                    <div class="chat-item" data-chat-id="current">
                        <div class="chat-item-header">
                            <h3 class="chat-title">Current Chat Session</h3>
                            <span class="chat-date">Today</span>
                        </div>
                        <div class="chat-preview">Welcome to GopiAI WebView Chat...</div>
                        <div class="chat-meta">
                            <span class="message-count">1 message</span>
                            <span class="chat-status current">Active</span>
                        </div>
                    </div>
                    
                    <div class="chat-item" data-chat-id="example-1">
                        <div class="chat-item-header">
                            <h3 class="chat-title">RAG Integration Discussion</h3>
                            <span class="chat-date">Yesterday</span>
                        </div>
                        <div class="chat-preview">Let's integrate RAG with Claude Tools...</div>
                        <div class="chat-meta">
                            <span class="message-count">15 messages</span>
                            <button class="delete-chat-btn" title="Delete Chat">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="chat-item" data-chat-id="example-2">
                        <div class="chat-item-header">
                            <h3 class="chat-title">UI Component Development</h3>
                            <span class="chat-date">2 days ago</span>
                        </div>
                        <div class="chat-preview">Working on WebView chat components...</div>
                        <div class="chat-meta">
                            <span class="message-count">8 messages</span>
                            <button class="delete-chat-btn" title="Delete Chat">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3,6 5,6 21,6"></polyline>
                                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="empty-state" id="empty-history" style="display: none;">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="empty-icon">
                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                        </svg>
                        <h3>No chat history</h3>
                        <p>Start a conversation to see your chat history here</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="modal" id="export-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Chat</h2>
                <button class="close-btn" id="close-export">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="export-format">Format:</label>
                    <select id="export-format">
                        <option value="json">JSON</option>
                        <option value="txt">Text</option>
                        <option value="md">Markdown</option>
                    </select>
                </div>
                <div class="setting-group">
                    <button id="download-btn" class="primary-btn">Download</button>
                    <button id="copy-btn" class="secondary-btn">Copy to Clipboard</button>
                </div>
                <div class="export-preview" id="export-preview">
                    <h3>Preview:</h3>
                    <pre id="export-content"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="chat.js"></script>
</body>
</html>