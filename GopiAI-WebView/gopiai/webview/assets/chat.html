<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GopiAI WebView Chat</title>
    <link rel="stylesheet" href="chat.css">
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS –∏ —Å–µ—Ç–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        console.log('Loading puter.js...');
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT') {
                console.error('Failed to load script:', e.target.src);
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-details').textContent = 'Failed to load: ' + e.target.src;
            }
        });
    </script>
    <script src="https://js.puter.com/v2/" onerror="console.error('puter.js failed to load')"></script>
    <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
</head>
<body>
    <div class="chat-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ -->
        <div class="chat-header">
            <div class="header-left">
                <h1>GopiAI Chat</h1>
                <div class="model-selector">
                    <label for="model-select">Model:</label>
                    <select id="model-select">
                        <option value="claude-sonnet-4" selected>Claude Sonnet 4</option>
                        <option value="claude-opus-4">Claude Opus 4</option>
                    </select>
                </div>
            </div>
            <div class="header-right">
                <button id="test-automation-btn" class="header-btn" title="Test Browser Automation">ü§ñ</button>
                <button id="export-btn" class="header-btn" title="Export Chat">üì•</button>
                <button id="clear-btn" class="header-btn" title="Clear Chat">üóëÔ∏è</button>
                <button id="settings-btn" class="header-btn" title="Settings">‚öôÔ∏è</button>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ -->
        <div id="error-message" style="display: none; background: #ff4444; color: white; padding: 10px; margin: 10px; border-radius: 5px;">
            <strong>‚ö†Ô∏è Network Error:</strong> <span id="error-details"></span>
            <br><small>Check your internet connection and firewall settings.</small>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div class="chat-messages" id="chat-messages">
            <div class="welcome-message">
                <div class="ai-message">
                    <div class="message-header">
                        <span class="sender">ü§ñ GopiAI Assistant</span>
                        <span class="model-badge">Claude Sonnet 4</span>
                    </div>
                    <div class="message-content">
                        Welcome to GopiAI WebView Chat! I'm powered by puter.js and ready to help you. 
                        You can switch between Claude Sonnet 4 and Claude Opus 4 models using the dropdown above.
                    </div>
                </div>
            </div>
        </div>

        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ -->
        <div class="typing-indicator" id="typing-indicator" style="display: none;">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <span class="typing-text">AI is thinking...</span>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ -->
        <div class="chat-input-area">
            <div class="input-container">
                <textarea 
                    id="message-input" 
                    placeholder="Type your message here... (Shift+Enter for new line, Enter to send)"
                    rows="1"
                ></textarea>
                <button id="send-btn" class="send-button" title="Send Message">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="modal" id="settings-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" id="close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="stream-toggle">Enable Streaming:</label>
                    <input type="checkbox" id="stream-toggle" checked>
                </div>
                <div class="setting-group">
                    <label for="auto-scroll-toggle">Auto-scroll to new messages:</label>
                    <input type="checkbox" id="auto-scroll-toggle" checked>
                </div>
                <div class="setting-group">
                    <label for="theme-select">Theme:</label>
                    <select id="theme-select">
                        <option value="light">Light</option>
                        <option value="dark" selected>Dark</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="modal" id="export-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Export Chat</h2>
                <button class="close-btn" id="close-export">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label for="export-format">Format:</label>
                    <select id="export-format">
                        <option value="json">JSON</option>
                        <option value="txt">Text</option>
                        <option value="md">Markdown</option>
                    </select>
                </div>
                <div class="setting-group">
                    <button id="download-btn" class="primary-btn">Download</button>
                    <button id="copy-btn" class="secondary-btn">Copy to Clipboard</button>
                </div>
                <div class="export-preview" id="export-preview">
                    <h3>Preview:</h3>
                    <pre id="export-content"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="chat.js"></script>
</body>
</html>