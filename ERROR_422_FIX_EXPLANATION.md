# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 422 –≤ RAG API

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

**–û—à–∏–±–∫–∞ HTTP 422 (Unprocessable Entity)** –ø—Ä–∏ `POST /sessions` –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–∂–∏–¥–∞–Ω–∏—è–º FastAPI —Å–µ—Ä–≤–µ—Ä–∞.

### ‚ùå –ß—Ç–æ –±—ã–ª–æ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```python
@app.post("/sessions")
async def create_session(title: str, project_context: str = None, tags: list = []):
    # –≠–Ω–¥–ø–æ–∏–Ω—Ç –æ–∂–∏–¥–∞–ª –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∞ –ø–æ–ª—É—á–∞–ª JSON
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –≠–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–Ω–∏–º–∞–ª –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
2. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–ª JSON –æ–±—ä–µ–∫—Ç
3. FastAPI –Ω–µ –º–æ–≥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ 422

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–î–æ–±–∞–≤–ª–µ–Ω—ã Pydantic –º–æ–¥–µ–ª–∏** –≤ `rag_memory_system/models.py`:

```python
class CreateSessionRequest(BaseModel):
    title: str = Field(..., description="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞")
    project_context: Optional[str] = Field(None, description="–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞")
    tags: List[str] = Field(default_factory=list, description="–¢–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏")

class AddMessageRequest(BaseModel):
    content: str = Field(..., description="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
    role: MessageRole = Field(..., description="–†–æ–ª—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è")
    metadata: Dict[str, Any] = Field(default_factory=dict, description="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ")
```

2. **–û–±–Ω–æ–≤–ª–µ–Ω—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** –≤ `rag_memory_system/api.py`:

```python
@app.post("/sessions")
async def create_session(request: CreateSessionRequest) -> dict:
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞"""
    try:
        session = memory_manager.create_session(request.title, request.project_context, request.tags)
        return {"session_id": session.session_id, "message": "–°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞"}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/sessions/{session_id}/messages")
async def add_message(session_id: str, request: AddMessageRequest) -> dict:
    """–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é"""
    try:
        message = memory_manager.add_message(session_id, request.role, request.content, request.metadata)
        return {"message_id": message.id, "message": "–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ"}
    except ValueError as e:
        raise HTTPException(status_code=404, detail=str(e))
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –¢–µ–ø–µ—Ä—å API –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã:

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏:**
```json
POST /sessions
{
    "title": "GopiAI Chat Session",
    "project_context": "GopiAI-WebView",
    "tags": ["webview", "chat", "interactive"]
}
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```json
POST /sessions/{session_id}/messages
{
    "content": "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
    "role": "user",
    "metadata": {"timestamp": "2025-06-16T10:30:00"}
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `simple_422_test.py`:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ RAG —Å–µ—Ä–≤–µ—Ä
cd rag_memory_system
python api.py

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python simple_422_test.py
```

## üìã –ß—Ç–æ –ù–ï —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–æ–±–ª–µ–º–æ–π

‚ùå **–ù–µ–ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ RAG** - –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ—à–∏–±–∫—É 422
‚ùå **–ü—Ä–æ–±–ª–µ–º—ã —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö** - –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å HTTP –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚ùå **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ ChromaDB** - –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–π

**–û—à–∏–±–∫–∞ 422 - —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ API.**

## üéâ –°—Ç–∞—Ç—É—Å

‚úÖ **–û—à–∏–±–∫–∞ 422 –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!**

- API —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JSON –∑–∞–ø—Ä–æ—Å—ã
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- –£–ª—É—á—à–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API (–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ `/docs`)
- –ö–æ–¥ –≤ `chat_memory.py` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**: http://127.0.0.1:8080/docs
2. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥**: http://127.0.0.1:8080
3. **–ß–µ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª–µ–π
4. **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏** –¥–ª—è –ª—É—á—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤ IDE

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–¢–µ–ø–µ—Ä—å –ø–∞–º—è—Ç—å GopiAI –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ 422!