# План исправления чата GopiAI - Первые две критические проблемы

## ПРОБЛЕМА 1: Конфликт импортов и fallback в main.py

### Диагноз:
- В main.py строка 9: `ChatWidget = BaseChatWidget` переопределяет правильный импорт
- В fallback (except блоке) используется неправильный BaseChatWidget
- WebViewChatWidget импортируется но не используется

### Шаги исправления:
1. **Удалить переопределение** (main.py, строка 9):
   - Удалить: `ChatWidget = BaseChatWidget`
   
2. **Исправить fallback логику** (main.py, строки 12-14):
   - В except блоке заменить `BaseChatWidget` на правильный fallback
   - Использовать простой QTextEdit как fallback или создать SimpleChat класс

3. **Проверить импорты** (main.py, строки 3-6):
   - Убедиться что WebViewChatWidget импортируется корректно
   - Добавить логирование для отслеживания какой виджет используется

## ПРОБЛЕМА 2: Неправильный порядок инициализации theme_manager

### Диагноз:
- theme_manager создается в строке 52 ПОСЛЕ создания chat_widget (строка 38)
- chat_widget не получает тему при инициализации
- Отсутствует связь между theme_manager и chat_widget

### Шаги исправления:
1. **Переместить инициализацию theme_manager** (main.py):
   - Создать theme_manager перед chat_widget (перед строкой 38)
   
2. **Передать theme_manager в chat_widget** (main.py, строка 38):
   - Модифицировать создание: `ChatWidget(theme_manager=theme_manager)`
   
3. **Обновить WebViewChatWidget** (webview_chat_widget.py):
   - Добавить параметр theme_manager в __init__
   - Применить тему сразу после создания webview

## ПОРЯДОК ВЫПОЛНЕНИЯ:
1. Сначала исправить ПРОБЛЕМУ 1 (импорты)
2. Затем исправить ПРОБЛЕМУ 2 (theme_manager)
3. Протестировать после каждого исправления
4. Убедиться что чат работает и темы применяются

## КРИТЕРИИ УСПЕХА:
- Чат загружается без ошибок
- Темы применяются корректно
- WebViewChatWidget используется (не fallback)
- Логи показывают правильную инициализацию