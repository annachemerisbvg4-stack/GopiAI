# Настройка логирования GopiAI

## Обзор

Система логирования GopiAI была настроена для записи только последнего лога и автоматической замены предыдущих файлов при каждом запуске приложения.

## Изменения

### 1. Модифицированный файл конфигурации логирования

**Файл:** `GopiAI-UI/gopiai/logging_config.py`

Добавлен новый параметр `single_file_mode`:
- `single_file_mode=True` - каждый запуск перезаписывает файл лога
- `single_file_mode=False` - использует ротацию логов (старое поведение)

### 2. Настройка UI логирования

**Файл:** `GopiAI-UI/gopiai/ui/main.py`

В функцию `main()` добавлена настройка логирования:
```python
from gopiai.logging_config import setup_logging
setup_logging(
    log_file_path='ui_debug.log',
    level=logging.INFO,
    console_output=False,
    single_file_mode=True  # Режим одного файла
)
```

### 3. Настройка CrewAI сервера

**Файл:** `GopiAI-CrewAI/crewai_api_server.py`

Модифицирована настройка `logging.basicConfig` для перезаписи файла при каждом запуске:
```python
# Удаляем старый файл лога
if os.path.exists(log_file):
    os.remove(log_file)

# Настраиваем логирование с перезаписью
logging.basicConfig(
    handlers=[
        logging.FileHandler(log_file, mode='w', encoding='utf-8'),
        logging.StreamHandler()
    ]
)
```

## Результат

### До изменений:
- Файлы логов накапливались при каждом запуске
- `ui_debug.log` содержал логи всех сессий
- `crewai_api_server_debug.log` содержал логи всех запусков сервера
- Множество файлов в папке `logs/` с временными метками

### После изменений:
- ✅ `ui_debug.log` - содержит только логи текущей сессии
- ✅ `crewai_api_server_debug.log` - содержит только логи текущего запуска сервера
- ✅ Старые логи автоматически удаляются при новом запуске
- ✅ Файлы логов остаются чистыми и актуальными

## Утилита очистки логов

Создан скрипт `clean_logs.py` для очистки накопившихся старых файлов логов:

```bash
python clean_logs.py
```

Скрипт удаляет:
- Все файлы в папках `logs/`
- Старые файлы логов компонентов
- Пустые директории логов

Сохраняет:
- `ui_debug.log` (текущий лог UI)
- `crewai_api_server_debug.log` (текущий лог сервера)

## Использование

### Запуск с новой системой логирования:

1. **UI приложение:**
   ```bash
   python GopiAI-UI/gopiai/ui/main.py
   ```
   Создаст/перезапишет `ui_debug.log`

2. **CrewAI сервер:**
   ```bash
   python GopiAI-CrewAI/crewai_api_server.py
   ```
   Создаст/перезапишет `crewai_api_server_debug.log`

3. **Очистка старых логов:**
   ```bash
   python clean_logs.py
   ```

### Настройка режима логирования:

Если нужно вернуть старое поведение (ротация логов), измените в `main.py`:
```python
setup_logging(
    log_file_path='ui_debug.log',
    single_file_mode=False  # Включить ротацию
)
```

## Преимущества новой системы

1. **Чистота:** Только актуальные логи
2. **Производительность:** Меньше файлов на диске
3. **Удобство:** Легко найти текущие логи
4. **Автоматизация:** Не нужно вручную удалять старые файлы
5. **Гибкость:** Можно переключаться между режимами

## Структура файлов логов

```
GOPI_AI_MODULES/
├── ui_debug.log                    # Текущий лог UI (перезаписывается)
├── GopiAI-CrewAI/
│   └── crewai_api_server_debug.log # Текущий лог сервера (перезаписывается)
├── clean_logs.py                   # Утилита очистки
└── LOGGING_SETUP.md               # Эта документация
```

## Устранение неполадок

### Если файл лога заблокирован:
```bash
# Проверьте статус файлов логов
python check_log_files.py
```

**Причины блокировки:**
- Файл открыт в редакторе (VS Code, Notepad++ и т.д.)
- Процесс приложения еще запущен
- Антивирус блокирует доступ

**Решения:**
1. Закройте файл в редакторе
2. Завершите все процессы GopiAI
3. Перезапустите приложение

### Если логи не перезаписываются:
1. Проверьте права доступа к файлам
2. Убедитесь, что файлы не заблокированы другими процессами
3. Используйте `check_log_files.py` для диагностики

### Если нужны старые логи:
1. Сделайте резервную копию перед запуском
2. Или временно отключите `single_file_mode=False`

### Если возникают ошибки Permission Denied:
1. Закройте файлы логов в редакторе
2. Запустите `check_log_files.py` для диагностики
3. При необходимости перезагрузите систему

### Утилиты для диагностики:
- `check_log_files.py` - проверка статуса файлов логов
- `clean_logs.py` - очистка старых логов
- `clean_logs.bat` - очистка для Windows